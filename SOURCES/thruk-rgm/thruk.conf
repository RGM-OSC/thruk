<IfModule mod_fcgid.c>
  AddHandler fcgid-script .sh
  IPCCommTimeout 120

  <Directory /srv/rgm/thruk/>
    Options FollowSymLinks
    AllowOverride All
    order allow,deny
    allow from all
  </Directory>

  # redirect to a startup page when there is no pidfile yet
  RewriteEngine On
  RewriteCond %{REQUEST_METHOD} GET
  RewriteCond %{REQUEST_URI} !^/thruk/startup.html
  RewriteCond %{REQUEST_URI} !^/thruk/side.html
  RewriteCond %{REQUEST_URI} !^/thruk/.*\.(css|png|js)
  RewriteCond %{REQUEST_URI} ^/thruk
  RewriteCond /srv/rgm/thruk/tmp/thruk.pid !-f
  RewriteRule ^(.*)$ /thruk/startup.html?$1 [R=302,L,NE,QSA]

  Alias /thruk/documentation.html /srv/rgm/thruk/root/thruk/documentation.html
  Alias /thruk/startup.html /srv/rgm/thruk/root/thruk/startup.html
  AliasMatch ^/thruk/(.*\.cgi|.*\.html) /srv/rgm/thruk/support/fcgid_env.sh/thruk/$1
  AliasMatch ^/thruk/plugins/(.*?)/(.*)$  /srv/rgm/thruk/plugins/plugins-enabled/$1/root/$2
  Alias /thruk/themes/  /srv/rgm/thruk/themes/themes-enabled/
  Alias /thruk /srv/rgm/thruk/root/thruk

  <Location /thruk>
        AuthType Basic
        AuthName "Restricted"
        AuthrgmAuthoritative On
        AuthrgmMySQLSocket /var/lib/mysql/mysql.sock
        AuthrgmMySQLUsername rgminternal
        AuthrgmMySQLPassword 0rd0-c0m1735-b47h0n143
        AuthrgmMySQLDB rgmweb
        AuthrgmMySQLTableSID sessions,users,groupright
        AuthrgmMySQLFieldUID sessions.user_id
        AuthrgmMySQLTableSIDCondition "`sessions`.`session_id`=$session_id AND `sessions`.`user_id`=$user_id AND `users`.`user_id`=$user_id AND `users`.`user_name`=$user_name AND `users`.`group_id`=$group_id AND `groupright`.`group_id`=$group_id AND `groupright`.`tab_1`='1'"
        AuthrgmPageLogin /login.php
        AuthrgmSessionCookies On
        Require valid-user

        Options ExecCGI FollowSymLinks
        Order allow,deny
        Allow from all
  </Location>
</IfModule>
